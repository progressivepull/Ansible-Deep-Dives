# 3.2 Ansible Templating

## {{ }} — Ansible / Jinja2 templating ✅

This is the **standard and correct syntax inside Ansible playbooks**.

### Key points:

* Provided by **Jinja2**, which Ansible uses for templating
* Used to reference **variables, expressions, filters, and facts**
* Evaluated **by Ansible at runtime**

## Variables Defined

``` yaml
name: Print a variable
  debug:
    msg: "Hello {{ username }}"
```

#### Line-by-line explanation

* **- name:** Print a variable
    - A human-readable description of the task.
    - Used for clarity in playbook output and logs.
    - It does not affect execution—only documentation/readability.

* **debug:**
* Calls Ansible’s built-in debug module.
* Commonly used to print messages or variable values during a playbook run.

* **msg: "Hello {{ username }}"**
* The message to display.
* {{ username }} is a Jinja2 variable expression.
* At runtime, Ansible replaces {{ username }} with the value of the variable username.

##### The task will output:

``` 
Hello john
```

## Where Ansible Variables Can Be Defined

### In the playbook (vars)

``` yaml
- hosts: all
  vars:
    username: john
  tasks:
    - debug:
        msg: "Hello {{ username }}"
```

### In inventory Files

#### In a INI inventory File
INI inventory is a plain-text configuration file used to define and organize the servers, network devices, and other hosts that the automation tool will manage.
```
[web]
server1 username=john
```

#### YAML inventory File
``` yaml
all:
  hosts:
    server1:
      username: john
```

### Directories

In Ansible, the **group_vars/** and **host_vars/** directories are used to store variables separately from the main inventory file. This structure keeps your configurations organized, especially as projects grow. 

#### Typical Directory Structure

```
.
├── inventory.ini      # Defines [web] group and server1
├── group_vars/
│   └── web.yml        # Vars for all 'web' servers
└── host_vars/
    └── server1.yml    # Vars specific only to 'server1'
```
inventory.ini
```
group_vars/
  web.yml
host_vars/
  server1.yml
```
```
# group_vars/web.yml
username: john
```

### Passed at runtime (extra vars)
``` bash
ansible-playbook playbook.yml -e "username=john"
```

### Registered Variables
In 2025, the Ansible register keyword remains a fundamental tool for building dynamic, responsive automation by capturing the complete output of a task into a host-level variable. This **captured data is stored in memory** as a structured dictionary, allowing subsequent tasks to access critical metadata such as standard output (stdout), return codes (rc), or whether the system state was actually modified (changed). This capability is essential for implementing complex conditional logic—such as rebooting a server only if a package update was successful—and for piping information between disparate modules in a single playbook run. 

``` yaml
- command: whoami
  register: result

- debug:
    msg: "User is {{ result.stdout }}"
```

In the first task, the command module executes whoami on the remote host, and the register: result directive instructs Ansible to save the task's metadata and output into a dictionary variable named result. In the second task, the debug module accesses this dictionary specifically to retrieve the stdout key, which contains the raw string of the command's standard output.

### Facts (automatic variables)

This code snippet illustrates the use of Ansible Facts, which are **system-level variables** automatically gathered from target hosts at the start of a playbook run. The debug module uses Jinja2 templating to reference {{ ansible_hostname }}, a built-in fact that stores the short hostname of the remote machine as discovered by the Ansible Setup Module.

```
- debug:
    msg: "Hostname is {{ ansible_hostname }}"
```


# References
* [Jinja - Python Templating Engine](https://jinja.palletsprojects.com/en/stable/)