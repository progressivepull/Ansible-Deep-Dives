# 2.4 Gather Facts

**ansible all -m gather_facts** is an ad-hoc Ansible command used to collect system information (“facts”) from all targeted hosts.

# Ansible collects comprehensive host data via the setup module. 
The gathered facts include:

* System Information
    - OS name, version, and distribution
    - Kernel version
    - Architecture (e.g., x86_64, arm64)
    - Hostname and Fully Qualified Domain Name (FQDN)
* Hardware Details
    - CPU count and individual cores
    - Memory (Total and free RAM)
    - Disk devices and mount points
* Networking
    - IP addresses (IPv4 and IPv6)
    - Network interfaces
    - Default gateway
    - DNS settings
Environment & Virtualization
    - Python version
    - Virtualization type (VM, container, or bare metal)
    - Cloud metadata (if running on platforms like AWS, Azure, or GCP)

# Use ansible_distribution (ad-hoc)

You can’t directly act on facts inside the same gather_facts command, but you can use them immediately in another ad-hoc command.

Example: Print the OS distribution
```
ansible webservers -m debug -a "var=ansible_distribution"
```

Output example:
```
web01 | SUCCESS => {
    "ansible_distribution": "Ubuntu"
}
```

# Example: Conditional logic (best done in a playbook)
Facts are mainly useful for conditionals.

```
- hosts: webservers
  gather_facts: yes
  tasks:
    - name: Install Apache on Debian-based systems
      apt:
        name: apache2
        state: present
      when: ansible_distribution in ["Ubuntu", "Debian"]

    - name: Install Apache on RHEL-based systems
      yum:
        name: httpd
        state: present
      when: ansible_distribution in ["RedHat", "Rocky", "Amazon"]
```
# Quick fact inspection command (recommended)

If you just want to see the distribution quickly:

```
ansible webservers -m setup -a 'filter=ansible_distribution'
```

This is more efficient than full fact gathering.

## What this command does (high level)

It **connects to all hosts in the** webservers **group** and **returns only the operating system distribution name** (for example: Ubuntu, RedHat, Rocky).

It’s a fast, targeted way to see what OS each web server is running.

## Command breakdown
**ansible**

Runs an ad-hoc Ansible command (not a playbook).

---

**webservers**

The inventory group being targeted.

Only hosts in the webservers group are contacted.

---

**-m setup**

Runs the setup **module**, which is Ansible’s **fact-gathering module**.

* **setup** is what Ansible normally uses behind the scenes when **gather_facts: yes**
* It collects system facts and stores them in **ansible_facts**

---

**-a 'filter=ansible_distribution'**

Passes arguments to the module.

filter= limits the output

ansible_distribution is the specific fact you want

Instead of returning hundreds of facts, Ansible returns only this one.

---

Example output

```
web01 | SUCCESS => {
    "ansible_facts": {
        "ansible_distribution": "Ubuntu"
    }
}

web02 | SUCCESS => {
    "ansible_facts": {
        "ansible_distribution": "Rocky"
    }
}
```

# Summary
| Task |	Command |
|-----------|------------------------------------------------------------|
| Gather facts	| ansible webservers -m gather_facts| 
| View OS	ansible|  webservers -m debug -a "var=ansible_distribution"| 
| Filter facts| 	ansible webservers -m setup -a 'filter=ansible_distribution'| 
| Use in logic| 	Playbook with when:| 

## [Context](./../context.md)